<!DOCTYPE html>
<html lang="en">
<head>
    <title>BLocalizer Tool</title>
    <meta charset="UTF-8">
    <script src="./node_modules/handsontable/dist/handsontable.full.min.js"></script>
    
    <link rel="stylesheet" href="./node_modules/handsontable/dist/handsontable.full.min.css" >
    <!-- <link rel="stylesheet" type="text/css" href="https://handsontable.com/static/css/main.css"> -->
    <link rel="stylesheet" type="text/css" href="assets/style.css">
</head>

<body>
<div>
    <ul>
        <li><a class="active" href="#home">Home</a></li>
        <li><a href="#news">News</a></li>
        <li><a href="#contact">Contact</a></li>
        <li><a href="#about">About</a></li>
    </ul>
</div>

<div id="table"> </div>

<script>
    let handsontableInstance;
    let currentFile = null

    // Load data to grid view
    function loadData (data, headers) {
        const container = document.getElementById('table');
        if (handsontableInstance != null) {
            handsontableInstance.updateSettings({  data : [] });
        }
        
        handsontableInstance = new Handsontable(container, {
                data: data,
                stretchH: 'all',
                autoWrapRow: true,
                manualRowResize: true,
                manualColumnResize: true,
                rowHeaders: true,
                colHeaders: headers,
                manualRowMove: true,
                manualColumnMove: true,
                exportFile: true,
                columnSorting: {
                    indicator: true
                },
                fixedColumnsLeft: 1,
                dropdownMenu: false,
                contextMenu: true,
                licenseKey: 'non-commercial-and-evaluation',
            })
    }

    // ipcRenderer for notification listening
    const { ipcRenderer } = require('electron')
    // Listen for message 'file-opened from main.js
    ipcRenderer.on('file-opened', (event, arg) => {
        // recieves message FROM main process main.js
        console.log('message "target" received arg:', arg)
        currentFile = arg

        const headers = [
            'Key',
            'Name',
            'Age',
            'Sex',
        ]

        const data = [
            ['Roger', 11, 11, 'MALE'],
            ['Jerome', , 11, 14, 'MALE'],
            ['Marlo', 31, 15, 'MALE']
        ];
        loadData(data, headers)
    })

    // Initialization
    if (currentFile === null) {
        const data = [
            ['pause_key', 'paused', '一時停止する'],
            ['start_key', 'start', 'スタート'],
            ['stop_key', 'start', 'ストップ']
        ];
        const headers = [
            'key',
            'en',
            'ja'
        ]
        loadData(data, headers)
    }

    // var button1 = document.getElementById('export-csv');
    // var exportPlugin1 = handsontableInstance.getPlugin('exportFile');

    // button1.addEventListener('click', function() {
    //     var exportedBlob = exportPlugin1.exportAsString('csv', {
    //     bom: false,
    //     columnDelimiter: ',',
    //     columnHeaders: true,
    //     exportHiddenColumns: true,
    //     exportHiddenRows: true,
    //     fileExtension: 'csv',
    //     filename: currentFile,
    //     mimeType: 'text/csv',
    //     rowDelimiter: '\r\n',
    //     rowHeaders: true
    //     });
    //     console.log(exportedBlob);
    // });
</script>

</body>
</html>